#summary Principe de fonctionnement du Projet.
#labels Featured,Phase-Requirements
= POURQUOI ? =

Legrand poss√®de plusieurs gammes de produit compatibles "InOne By Legrand" (IOBL) qui proposent des fonctionnalit√©s de domotique, celles-ci permettent une interaction entre les interrupteurs, les ouvrants, le chauffage, etc.
Legrand a √©galement fabriquer une passerelle permettant un acc√®s entre leurs produits IOBL et un port USB informatique (R√©f√©rence Legrand : 88213). Le protocole employ√© est un d√©riv√© de l'OPENWEBNET mais il ne se comporte pas exactement de la m√™me fa√ßon ce qui ferme les portes √  un grand nombre d‚Äôapplications r√©centes compatible MyHome bas√© int√©gralement sur la nome OPENWEBNET. La norme employ√© par Legrand a √©t√© renomm√© IOBL et reste actuellement peu utilis√©e car consid√©r√©e comme obsol√®te et en fin de vie.
Le projet propose donc une suite d'outil permettant d'interagir avec le protocole IOBL, il est donc n√©cessaire de poss√©der au pr√©alable :
  * un circuit √©lectrique en 220V ÔÅä
  * des produits estampill√©s ¬´ InOne By Legrand ¬ª (C√©liane, Plexo, Sagane, Mosaic, etc.)
  * une interface Legrand 88213
  * Une Carte Raspberry Pi pour une installation autonome et sans prÈ-configuration

= LE SERVEUR =

== Introduction ==

Le serveur permet la r√©cup√©ration, l'interpr√©tation et l'archivage des commandes provenant de l‚Äôinterface 88213 en OPENWEBNET IOBL.

== Principe de fonctionnement ==

  # Une commande est envoy√©e sur le r√©seau CPL
  # L'interface Legrand 88213 la retranscrit sur le port USB en OPENWEBNET
  # Un convertisseur SERIAL->TCP cr√©√© un socket en TCP pour transmettre la commande
  # Le script server.php ouvre un socket vers le port SERIAL(USB) pour r√©cup√©rer la commande
  # Le script server.php interpr√®te et analyse la commande puis met √  jour la base de donn√©es MYSQL
  # Le SERVEUR peut √©galement faire le processus inverse pour l‚Äôenvoie de commande, DB->SERVEUR->TCP->SERIAL(USB)->88213->CPL

== Pr√©requis ==

Le SERVEUR :
  * fonctionne sur une carte Raspberry Pi OS LINUX (tout est prÈ-configurÈ)
  * il contient un daemon pour le lancer automatiquement ou le redÈmarrÈ
  * peut Ègalement fonctionner dans n'importe qu'elle environnement Windows ou Unix, dans ce cas :
    * doit √™tre utilis√© avec le couple PHP/MYSQL (avec les extensions necessaires)
    * peut √™tre lanc√© sur IIS ou Apache
    * doit √™tre lanc√© en mode client et non graphique
    * ne fonctionne qu'avec un convertisseur SERIAL/TCP du type : SER2NET, SERPROXY, etc.

== Fichiers utilis√©s ==

Le daemon de dÈmarrage (Uniquement sous Unix dans la version Raspberry Pi prÈ-configurÈ)
Le fichier server.php + fichiers connexes de configuration

= LA DB =

== Introduction ==

La DB est la base de donn√©e MYSQL elle est interrog√©e UNIQUEMENT au travers du SERVER.

== Principe de fonctionnement ==

  Elle contient :
  # Les trames OPENWEBNET brutes qui circulent sur le CPL
  # Les trames d√©crypt√©es sous un format lisible
  # Les r√©f√©rences et d√©finitions des √©quipements Legrand qui sont g√©r√©s
  # Les r√©f√©rences des √©quipements que l'utilisateur poss√®de
  # L'√©tat des √©quipements enregistr√©s
  # Les sc√©narios enregistr√©s

== Pr√©requis ==

Elle doit imp√©rativement :
  * Fonctionner sous MYSQL
  * Contenir ses proc√©dures stock√©es
  * Contenir ses vues
  * Contenir les d√©finitions des √©quipements Legrand

= LE CLIENT =

== Introduction ==

Il permet de s'interfacer entre le SERVEUR et la DB. 

== Pr√©requis ==

Ils sont identiques au SERVEUR sauf :
  * Il est appel√© en HTTP depuis n‚Äôimporte qu‚Äôelle navigateur/logiciel d‚Äôint√©gration avec des param√®tres en GET
  * Certaines fonctionnalites necessittes des droits utilisateurs particuliers (UNIX)
  * Certaines fonctionnalites ne fonctionne pas sous Windows (Redemmarage serveur, etc.)

== Principe de fonctionnement ==

Le CLIENT est normalement le seul lien entre le SERVEUR et la DB toutes les op√©rations transitent par des demandes en HTTP avec des param√®tres en GET qui retourne de l‚ÄôXML, par exemple : 
  # Appel de http://ip_serveur/HTPC/legrand/client.php?get_last_trames=20
  # Le CLIENT r√©cup√®re en DB les 20 derni√®res trames qui ont circul√©es
  # Le CLIENT retourne en XML le r√©sultat
Autre exemple d‚Äôenvoi de commande :
  # Appel de http://ip_serveur/HTPC/legrand/client.php?send_trame=YZ1000Y8620320Y51ZZ
  # Le CLIENT converti YZ1000Y8620320Y51ZZ en *#1000*8620320*51##
  # Le CLIENT envoie dans la DB temporaire la trame convertie
  # Le SERVEUR r√©cup√®re la trame en DB et la transmet en TCP
  # Le convertisseur TCP->SERIAL la renvoie √  l‚Äôinterface 88213 sur le CPL

== Fichiers utilis√©s ==

Le fichier client.php + fichiers connexes de configuration

= L'INTERFACE WEB =

== Introduction ==

L'interface web permet d'envoyer et de r√©cup√©rer des commandes du CLIENT, elle est cod√©e en PHP/HTML/JAVASCRIPT basÈ sur le framwork ExtJs.
Elle est amen√©e √  √©voluer sans cesse pour ajouter les nouvelles fonctionnalit√©s du CLIENT et du SERVEUR. A terme elle devrait √™tre compatible avec tous les navigateurs et support√©s √©galement les Tablettes et Smartphones.

= L'API IVIEWER =

== Introduction ==

Cette API cod√©e en JAVASCRIPT permet d‚Äôint√©grer directement √  Iviewer de Command Fusion les fonctionnalit√©s du CLIENT. Le r√©sultat obtenu est une interface personnalisable compatible IPAD/IPHONE et ANDROID.
Pour plus de renseignement sur Iviewer : [http://www.commandfusion.com/ commandfusion.com] 